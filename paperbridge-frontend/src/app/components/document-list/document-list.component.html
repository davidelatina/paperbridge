<div class="document-list-container">
  <header class="header">
    <div class="header-content">
      <div>
        <h1>Documents</h1>
        <p class="subtitle">Browse and manage your documents</p>
      </div>
      <button class="upload-button" (click)="toggleUploadForm()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 3V15M12 3L8 7M12 3L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ showUploadForm() ? 'Cancel' : 'Upload Document' }}
      </button>
    </div>
  </header>

  @if (showUploadForm()) {
    <div class="upload-form-container">
      <form class="upload-form" (ngSubmit)="uploadDocument()">
        <h2>Upload New Document</h2>
        
        <div class="form-group">
          <label for="file-input" class="file-label">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{{ selectedFile ? selectedFile.name : 'Choose a file to upload' }}</span>
          </label>
          <input 
            type="file" 
            id="file-input" 
            class="file-input" 
            (change)="onFileSelected($event)"
            accept=".pdf,.doc,.docx,.txt"
            [disabled]="uploading()"
          />
          @if (selectedFile) {
            <div class="file-info">
              <span class="file-size">{{ formatFileSize(selectedFile.size) }}</span>
            </div>
          }
        </div>

        @if (uploadError()) {
          <div class="form-error">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span>{{ uploadError() }}</span>
          </div>
        }

        <div class="form-actions">
          <button 
            type="submit" 
            class="submit-button" 
            [disabled]="!selectedFile || uploading()"
          >
            @if (uploading()) {
              <div class="spinner-small"></div>
              <span>Uploading...</span>
            } @else {
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 3V15M12 3L8 7M12 3L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Upload</span>
            }
          </button>
        </div>
      </form>
    </div>
  }

  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading documents...</p>
    </div>
  }

  @if (error()) {
    <div class="error">
      <p>{{ error() }}</p>
      <button class="retry-button" (click)="loadDocuments()">Retry</button>
    </div>
  }

  @if (!loading() && !error()) {
    <div class="split-container">
      <div class="sidebar" [style.width.px]="sidebarWidth()">
        <app-directory-tree 
          [documents]="allDocuments()" 
          (pathSelected)="onPathSelected($event)"
        />
      </div>
      <div 
        class="resizer" 
        [class.resizing]="isResizing()"
        (mousedown)="onMouseDown($event)"
      ></div>
      <div class="main-content">
        @if (documents().length === 0) {
          <div class="empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M10 9H9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h2>No documents found</h2>
            <p>Get started by uploading your first document.</p>
          </div>
        } @else {
          <div class="document-grid">
            @for (document of documents(); track document.id) {
              <div class="document-card">
                <div class="document-header">
                  <h3 class="document-title">{{ document.title || 'Untitled Document' }}</h3>
                  <span class="document-id">#{{ document.id }}</span>
                </div>
                
                <div class="document-content">
                  @if (document.content) {
                    <p class="document-preview">{{ document.content.substring(0, 150) }}{{ document.content.length > 150 ? '...' : '' }}</p>
                  } @else {
                    <p class="document-preview no-content">No content available</p>
                  }
                </div>

                <div class="document-meta">
                  <div class="file-path">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M13 3H19V9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M13 3L19 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>{{ document.filePath }}</span>
                  </div>
                </div>

                @if (document.tags && document.tags.length > 0) {
                  <div class="document-tags">
                    @for (tag of document.tags; track tag) {
                      <span class="tag">{{ tag }}</span>
                    }
                  </div>
                }

                <div class="document-footer">
                  <div class="document-dates">
                    <div class="date-item">
                      <span class="date-label">Created:</span>
                      <span class="date-value">{{ formatDate(document.createdAt) }}</span>
                    </div>
                    <div class="date-item">
                      <span class="date-label">Updated:</span>
                      <span class="date-value">{{ formatDate(document.updatedAt) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }
</div>
